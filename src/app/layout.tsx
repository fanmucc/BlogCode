import { cookies } from "next/headers";
// import { Inter } from "next/font/google";

// const inter = Inter({ subsets: ["latin"] });
// 组件
import WebFooter from "@/components/WebFooter";

import "./globals.css";

import type { Metadata } from "next";
import { RequestCookie } from "next/dist/compiled/@edge-runtime/cookies";

export const metadata: Metadata = {
	title: "Create Next App",
	description: "Generated by create next app",
};

export default function RootLayout({
	children,
}: {
	children: React.ReactNode;
}) {
	const cookieStore = cookies();
	// 没有的话 则为auto 自适应
	const theme: RequestCookie | undefined = cookieStore.get(
		"blog_next_theme_type"
	);
	const themeValue: string = theme?.value || "";

	return (
		<html lang='en'>
			<body className={themeValue}>
				<script
					dangerouslySetInnerHTML={{
						__html: `
                (function () {
									try {
										const allCookies = document.cookie;
										// 将所有 cookie 切割成数组
										const cookiesArray = allCookies.split(';');
										// 遍历数组以获取特定 cookie 的值
										let theme;
										for (const cookie of cookiesArray) {
												const [cookieName, cookieContent] = cookie.trim().split('=');
												// 检查是否是你想要的 cookie
												if (cookieName === 'blog_next_theme_type') {
													theme = cookieContent;
														break;
												}
										}
										if (theme) return
										const darkModeMediaQuery = window.matchMedia(
											"(prefers-color-scheme: dark)"
										);
										const isDarkMode = darkModeMediaQuery.matches;
										if (isDarkMode) {
											document.body.classList.add('dark')
										} else {
											document.body.classList.add('light')
										}
									} catch(err) {}
								})()`,
					}}
				/>
				{children}
				<WebFooter />
			</body>
		</html>
	);
}
